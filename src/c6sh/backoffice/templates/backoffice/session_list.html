{% extends 'backoffice/base.html' %}
{% load i18n %}

{% block content %}
{% if check_errors %}
    <div class="alert alert-warning">
        <strong>{% trans "We found some settings in your installation that are probably incorrect. We recommend that you check them again :)" %}</strong>
        <ul>
            {% for e in check_errors %}
                <li>{{ e }}</li>
            {% endfor %}
        </ul>
    </div>
{% endif %}
<table class="table" id="active-sessions-table">
	<thead>
		<th></th>
		<th>Engel</th>
		<th>Dauer</th>
		<th>Produkte</th>
		<th>Kasse</th>
	</thead>
	<tbody>
        {% language "de" %}
		{% for cashdesk in cashdesks %}
			{% for session in cashdesk.get_active_sessions %}
				<tr>
					<th class="session-action-column">
                        <a href="{% url "backoffice:session-detail" pk=session.pk %}" title="Details">
                            <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span>
                        </a>
                        <a href="{% url "backoffice:resupply-session" pk=session.pk %}" title="Nachfüllen">
							<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
						</a>
                        <a href="{% url "backoffice:end-session" pk=session.pk %}" title="Auszählen">
                        	<span class="glyphicon glyphicon-off" aria-hidden="true"></span>
						</a>
                    </th>
					<th> {{ session.user }} </th>
					<th>seit {{ session.start|timesince }} </th>
					<th>
                        <ul>
                        {% for product in session.get_current_items %}
                            <li>{{ product.item }}: {{ product.transactions }}</li>
                        {% endfor %}
                        </ul>
                    </th>
                    {% with session_count=cashdesk.get_active_sessions|length %}
                        {% if session_count > 1 %}
                            {% if forloop.first %}
                                <th rowspan="{{ session_count }}">{{ session.cashdesk }}</th>
                            {% endif %}
                        {% else %}
                            <th>{{ session.cashdesk }}</th>
                        {% endif %}
                    {% endwith %}

				</tr>
            {% empty %}
                <tr>
                    <th colspan="42" class="empty-row active">
                        {{ cashdesk }}
                        <a href="{% url "backoffice:new-session" %}?desk={{ cashdesk.pk }}">einzählen.</a>
                    </th>
                <tr>
			{% endfor %}
		{% endfor %}
        {% endlanguage %}
	</tbody>
</table>

{% endblock %}
